<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vitals Validator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/genralPages.css">
  <script src="https://kit.fontawesome.com/834304401a.js" crossorigin="anonymous"></script>
  <script src="/script.js"></script>
  <style>
    body {
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      font-size: 16px;
      font-weight: bold;
      line-height: 1.6;
      color: #333;
      background-image: url("/images/vitalsValidator.svg");
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
    }

    main {
      max-width: 900px;
      margin: 1.5rem auto;
      padding: 1rem 1.25rem;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 10px;
    }

    h1.page-title {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      color: #003366;
    }

    p.intro {
      font-weight: normal;
      margin-bottom: 1rem;
    }

    form {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.75rem 1rem;
      margin-bottom: 1rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    label {
      margin-bottom: 0.2rem;
      font-size: 0.9rem;
    }

    input[type="number"] {
      width: 100%;
      padding: 0.4rem 0.5rem;
      font-size: 0.95rem;
      font-weight: normal;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    button[type="submit"] {
      grid-column: 1 / -1;
      margin-top: 0.5rem;
      padding: 0.5rem 0.75rem;
      font-size: 1rem;
      font-weight: 600;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background-color: #005daa;
      color: #fff;
    }

    button[type="submit"]:hover {
      background-color: #003b72;
    }

    .alerts {
      margin-bottom: 0.75rem;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      background: #ffebee;
      border: 1px solid #e53935;
      font-weight: normal;
      display: none;
    }

    .alerts ul {
      margin: 0;
      padding-left: 1.2rem;
    }

    .alerts li {
      margin-bottom: 0.25rem;
    }

    .results-card {
      padding: 0.75rem 0.9rem;
      border-radius: 6px;
      background: #f5f5f5;
      border: 1px solid #ddd;
      font-weight: normal;
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 0.5rem 1rem;
      margin-top: 0.25rem;
    }

    .result-item {
      font-size: 0.95rem;
    }

    .badge {
      display: inline-block;
      margin-left: 0.3rem;
      padding: 0.05rem 0.4rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .badge-ok {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .badge-warn {
      background: #ffebee;
      color: #c62828;
    }

    .badge-borderline {
      background: #fff8e1;
      color: #f57c00;
    }

    @media (max-width: 600px) {
      main {
        margin: 0.75rem;
        padding: 0.75rem;
      }

      form {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo-container">
      <h1 class="main-header">Vitals Validator</h1>
      <a href="/index.html" title="Home"><i class="fa-solid fa-house"></i></a>
      <button class="back-button" onclick="goBack()">Back</button>
    </div>
  </header>

  <main>
    <h1 class="page-title">Patient Vital Measurements</h1>
    <p class="intro">
      Use this tool to check whether key vital signs are within expected ranges and to calculate
      <strong>BMI</strong>, <strong>MAP</strong> and <strong>Shock Index</strong>. It’s a guide only – always interpret in the clinical context.
    </p>

    <form id="vitals-form">
      <div class="form-group">
        <label for="weight">Weight (kg)</label>
        <input type="number" id="weight" name="weight" step="0.1" min="1" required>
      </div>

      <div class="form-group">
        <label for="height">Height (cm)</label>
        <input type="number" id="height" name="height" step="0.1" min="50" required>
      </div>

      <div class="form-group">
        <label for="blood_pressure_systolic">Systolic BP (mmHg)</label>
        <input type="number" id="blood_pressure_systolic" name="blood_pressure_systolic" step="1" min="50" max="260" required>
      </div>

      <div class="form-group">
        <label for="blood_pressure_diastolic">Diastolic BP (mmHg)</label>
        <input type="number" id="blood_pressure_diastolic" name="blood_pressure_diastolic" step="1" min="30" max="150" required>
      </div>

      <div class="form-group">
        <label for="heart_rate">Heart Rate (bpm)</label>
        <input type="number" id="heart_rate" name="heart_rate" step="1" min="20" max="250" required>
      </div>

      <div class="form-group">
        <label for="blood_glucose">Blood Glucose (mmol/L)</label>
        <input type="number" id="blood_glucose" name="blood_glucose" step="0.1" min="1" required>
      </div>

      <div class="form-group">
        <label for="oxygen_saturation">Oxygen Saturation (%)</label>
        <input type="number" id="oxygen_saturation" name="oxygen_saturation" step="0.1" min="50" max="100" required>
      </div>

      <div class="form-group">
        <label for="temperature">Temperature (°C)</label>
        <input type="number" id="temperature" name="temperature" step="0.1" min="30" max="45" required>
      </div>

      <button type="submit">Validate &amp; Calculate</button>
    </form>

    <div id="alerts" class="alerts"></div>

    <div id="results" class="results-card">
      <strong>Calculated values will appear here.</strong>
      <p style="margin-top:0.3rem;font-size:0.9rem;">
        You’ll see BMI, MAP and Shock Index with quick interpretations.
      </p>
    </div>
  </main>

  <script>
    function calculateMAP(sys, dia) {
      if (isNaN(sys) || isNaN(dia)) return null;
      return dia + (sys - dia) / 3;
    }

    function calculateBMI(weight, heightCm) {
      if (isNaN(weight) || isNaN(heightCm) || heightCm <= 0) return null;
      const heightM = heightCm / 100;
      return weight / (heightM * heightM);
    }

    // Shock Index = HR / SBP
    function calculateShockIndex(sys, hr) {
      if (isNaN(sys) || isNaN(hr) || sys <= 0) return null;
      return hr / sys;
    }

    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('vitals-form');
      const alertsBox = document.getElementById('alerts');
      const resultsBox = document.getElementById('results');

      form.addEventListener('submit', (event) => {
        event.preventDefault();

        const weight = parseFloat(document.getElementById('weight').value);
        const height = parseFloat(document.getElementById('height').value);
        const systolic = parseFloat(document.getElementById('blood_pressure_systolic').value);
        const diastolic = parseFloat(document.getElementById('blood_pressure_diastolic').value);
        const heartRate = parseFloat(document.getElementById('heart_rate').value);
        const bloodGlucose = parseFloat(document.getElementById('blood_glucose').value);
        const oxygenSaturation = parseFloat(document.getElementById('oxygen_saturation').value);
        const temperature = parseFloat(document.getElementById('temperature').value);

        const messages = [];

        // Heart rate
        if (heartRate < 60) {
          messages.push("Heart rate &lt; 60 bpm: bradycardia – check ECG, meds, electrolytes and perfusion.");
        } else if (heartRate > 100 && heartRate <= 150) {
          messages.push("Heart rate &gt; 100 bpm: tachycardia – consider pain, sepsis, hypovolaemia, PE, arrhythmia.");
        } else if (heartRate > 150) {
          messages.push("Heart rate &gt; 150 bpm: severe tachycardia – urgent ECG and assessment.");
        }

        // Oxygen saturation
        if (oxygenSaturation < 94) {
          messages.push("SpO₂ &lt; 94%: hypoxia – assess airway, breathing and need for oxygen / escalation.");
        }

        // Glucose
        if (bloodGlucose < 3.1) {
          messages.push("Blood glucose &lt; 3.1 mmol/L: hypoglycaemia – treat immediately with oral/IV glucose.");
        } else if (bloodGlucose > 17) {
          messages.push("Blood glucose &gt; 17 mmol/L: consider DKA/HHS – check ketones, ABG/VBG and U&amp;E.");
        }

        // Temperature
        if (temperature >= 38) {
          messages.push("Temperature ≥ 38 °C: fever – consider infection, inflammation, drug reaction or heat illness.");
        } else if (temperature < 35) {
          messages.push("Temperature &lt; 35 °C: hypothermia – rewarm and look for causes (sepsis, exposure, endocrine).");
        }

        // Blood pressure
        if (systolic < 90) {
          messages.push("Systolic BP &lt; 90 mmHg: hypotension – treat as possible shock until proven otherwise.");
        } else if (systolic >= 180 || diastolic >= 120) {
          messages.push("BP ≥ 180/120 mmHg: severe hypertension – exclude hypertensive emergency.");
        }

        // Shock Index (HR / SBP)
        const shockIndex = calculateShockIndex(systolic, heartRate);
        if (shockIndex !== null) {
          if (shockIndex >= 1.3) {
            messages.push("Shock Index ≥ 1.3: very high – strong concern for shock; consider urgent resuscitation and admission.");
          } else if (shockIndex >= 0.9) {
            messages.push("Shock Index ≥ 0.9: abnormal – look for sepsis, hypovolaemia, haemorrhage or cardiogenic causes.");
          }

          // Simple sepsis-style red flag
          if (shockIndex >= 0.9 && temperature >= 37.8) {
            messages.push("Fever + raised Shock Index: possible septic shock – investigate and treat urgently.");
          }
        }

        // BMI
        const bmi = calculateBMI(weight, height);
        let bmiBadgeClass = "badge-ok";
        let bmiText = "Normal";

        if (bmi !== null) {
          if (bmi < 18.5) {
            bmiBadgeClass = "badge-warn";
            bmiText = "Underweight";
          } else if (bmi >= 25 && bmi < 30) {
            bmiBadgeClass = "badge-borderline";
            bmiText = "Overweight";
          } else if (bmi >= 30) {
            bmiBadgeClass = "badge-warn";
            bmiText = "Obese";
          }
        }

        // MAP
        const map = calculateMAP(systolic, diastolic);
        let mapBadgeClass = "badge-ok";
        let mapText = "Normal";

        if (map !== null) {
          if (map < 60) {
            mapBadgeClass = "badge-warn";
            mapText = "Low – poor organ perfusion likely";
          } else if (map > 100) {
            mapBadgeClass = "badge-borderline";
            mapText = "High – often chronic hypertension";
          }
        }

        // Shock Index badge
        let siBadgeClass = "badge-ok";
        let siText = "Normal";

        if (shockIndex !== null) {
          if (shockIndex >= 1.3) {
            siBadgeClass = "badge-warn";
            siText = "Very high – shock likely";
          } else if (shockIndex >= 0.9) {
            siBadgeClass = "badge-borderline";
            siText = "Raised – concern for shock";
          }
        }

        // Build results card
        let resultsHtml = "<strong>Calculated values:</strong>";
        resultsHtml += '<div class="results-grid">';

        resultsHtml += '<div class="result-item">';
        resultsHtml += `BMI: ${bmi !== null ? bmi.toFixed(1) : "N/A"}`;
        if (bmi !== null) {
          resultsHtml += ` <span class="badge ${bmiBadgeClass}">${bmiText}</span>`;
        }
        resultsHtml += "</div>";

        resultsHtml += '<div class="result-item">';
        resultsHtml += `MAP: ${map !== null ? map.toFixed(0) + " mmHg" : "N/A"}`;
        if (map !== null) {
          resultsHtml += ` <span class="badge ${mapBadgeClass}">${mapText}</span>`;
        }
        resultsHtml += "</div>";

        resultsHtml += '<div class="result-item">';
        resultsHtml += `Shock Index: ${shockIndex !== null ? shockIndex.toFixed(2) : "N/A"}`;
        if (shockIndex !== null) {
          resultsHtml += ` <span class="badge ${siBadgeClass}">${siText}</span>`;
        }
        resultsHtml += "</div>";

        resultsHtml += "</div>";

        resultsBox.innerHTML = resultsHtml;

        // Show alerts
        if (messages.length > 0) {
          alertsBox.style.display = "block";
          alertsBox.innerHTML = `
            <strong>Red flags / points to consider:</strong>
            <ul>${messages.map(m => `<li>${m}</li>`).join("")}</ul>
          `;
        } else {
          alertsBox.style.display = "block";
          alertsBox.innerHTML = `
            <strong>No critical abnormalities detected.</strong>
            <p style="margin:0.25rem 0 0;font-size:0.9rem;">
              Always re-check the patient, not just the numbers.
            </p>
          `;
        }
      });
    });
  </script>
</body>
</html>
