<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Blood Transfusion Calculator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/genralPages.css">
    <script src="https://kit.fontawesome.com/834304401a.js" crossorigin="anonymous"></script>
    <script src="/script.js"></script>
    <style>
      body {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 16px;
        font-weight: bold;
        line-height: 1.8;
        color: #333;
        background-image: url("/images/bloodTestGuides.svg");
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center;
      }

      main {
        max-width: 900px;
        margin: 1.5rem auto 3rem auto;
        padding: 1.5rem;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      }

      h1 {
        text-align: center;
        margin-bottom: 0.5rem;
      }

      h2, h3 {
        text-decoration: underline;
        margin-top: 1.5rem;
      }

      form {
        margin: 0 auto 1.5rem auto;
        max-width: 600px;
        padding: 1.25rem;
        border: 1px solid #ccc;
        border-radius: 10px;
        background: #fafafa;
      }

      label {
        display: block;
        margin-bottom: 0.5rem;
      }

      input[type="number"] {
        display: block;
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: #f8f8f8;
        font-size: 1rem;
      }

      button {
        margin-top: 15px;
        padding: 10px 16px;
        border-radius: 5px;
        background-color: #4CAF50;
        color: white;
        font-size: 16px;
        cursor: pointer;
        border: none;
      }

      button:hover {
        background-color: #3e8e41;
      }

      #transfusion-result {
        font-size: 1.1rem;
        text-align: center;
        margin-top: 15px;
      }

      .note {
        font-size: 0.85rem;
        font-weight: normal;
        color: #555;
      }

      ul {
        padding-left: 1.5rem;
      }

      @media (max-width: 768px) {
        main {
          margin: 1rem;
          padding: 1rem;
        }

        form {
          padding: 1rem;
        }
      }
    </style>
  </head>

  <body class="vitals-page">
    <header>
      <nav class="logo-container">
        <div class="logo-container">
          <h1 class="main-header">Blood Transfusion Calculator</h1>
          <div class="navbar-icons">
            <a href="/index.html" title="Home">
              <i class="fa-solid fa-house" alt="House icon"></i>
            </a>
          </div>
          <button class="back-button" onclick="goBack()">Back</button>
        </div>
      </nav>
    </header>

    <main>
      <section>
        <h1>Blood Transfusion Calculator</h1>
        <p>
          This tool estimates the number of red cell units required based on the current haemoglobin (Hb)
          and a <strong>target Hb of 10 g/dL in the Emergency Department</strong>.
          <span class="note">
            (Always individualise according to comorbidities and your local transfusion protocol –
            many modern guidelines favour lower thresholds in stable patients.)
          </span>
        </p>
      </section>

      <section>
        <form id="transfusion-form" onsubmit="event.preventDefault(); calculateTransfusion();">
          <label for="hb-level">
            Enter current haemoglobin (g/dL):
            <br>
            <span style="color: brown; font-size: 0.85rem; font-weight: normal;">
              If your Hb is in different units, please convert to g/dL.
            </span>
          </label>
          <input
            type="number"
            id="hb-level"
            name="hb-level"
            min="0"
            max="20"
            step="0.1"
            required
          />

          <button type="submit">Calculate Units</button>

          <h2>Transfusion recommendation</h2>
          <p id="transfusion-result"></p>
        </form>
      </section>

      <section>
        <h2>Blood Transfusion Reactions</h2>
        <p>
          <strong>Overview:</strong>
          Blood transfusion reactions range from mild to life-threatening and require
          rapid recognition and management.
        </p>

        <h3>Types of reactions</h3>
        <ul>
          <li>
            <strong>Acute haemolytic:</strong>
            Usually due to ABO incompatibility. Fever, flank/back pain, hypotension, haemoglobinuria.
          </li>
          <li>
            <strong>Allergic:</strong>
            Urticaria, pruritus, can progress to anaphylaxis.
          </li>
          <li>
            <strong>Febrile non-haemolytic:</strong>
            Fever and chills without haemolysis; most common reaction.
          </li>
          <li>
            <strong>TRALI:</strong>
            Acute hypoxia and non-cardiogenic pulmonary oedema within 6 hours of transfusion.
          </li>
          <li>
            <strong>TACO:</strong>
            Respiratory distress, hypertension, raised JVP, evidence of fluid overload.
          </li>
        </ul>

        <h3>Severity classification</h3>
        <p>
          Reactions are typically graded from mild to severe based on symptoms,
          haemodynamic stability, and organ involvement.
        </p>

        <h3>Management principles</h3>
        <p><strong>Immediate actions (for any suspected reaction):</strong></p>
        <ul>
          <li>Stop the transfusion immediately.</li>
          <li>Keep the IV line open with normal saline.</li>
          <li>Check vital signs and perform a quick ABC assessment.</li>
          <li>Re-check patient identity and blood pack details.</li>
        </ul>

        <p><strong>Examples of specific treatment:</strong></p>
        <ul>
          <li>
            <strong>Mild allergic reactions:</strong>
            Stop transfusion, give antihistamine (e.g. chlorpheniramine), observe and reassess.
          </li>
          <li>
            <strong>Anaphylaxis:</strong>
            IM adrenaline as per anaphylaxis protocol, airway/oxygen, IV fluids, antihistamines, steroids.
          </li>
          <li>
            <strong>Acute haemolytic reactions:</strong>
            Stop transfusion, high-flow oxygen, IV fluids, monitor urine output, inform blood bank urgently.
          </li>
          <li>
            <strong>Febrile non-haemolytic:</strong>
            Antipyretics (e.g. paracetamol) and observation once serious causes are excluded.
          </li>
          <li>
            <strong>TRALI:</strong>
            Oxygen, ventilatory support as needed; usually no diuretics (non-cardiogenic pulmonary oedema).
          </li>
          <li>
            <strong>TACO:</strong>
            Sit patient up, oxygen, IV diuretics, slow/stop transfusion and reassess need for further units.
          </li>
        </ul>

        <p><strong>Reporting:</strong> All suspected reactions should be reported to the blood bank and documented.</p>
      </section>

      <section>
        <h2>Platelet Transfusion</h2>
        <p>
          <strong>Indications (typical adult thresholds, adjust to local protocol):</strong>
        </p>
        <ul>
          <li>Platelets &lt; 10 × 10<sup>9</sup>/L in stable, non-bleeding patient.</li>
          <li>Platelets &lt; 20 × 10<sup>9</sup>/L with fever, sepsis or other risk factors for bleeding.</li>
          <li>Platelets &lt; 50 × 10<sup>9</sup>/L with active bleeding or before invasive procedures/surgery.</li>
        </ul>
        <p>
          <strong>Precautions:</strong> Confirm indication, ABO compatibility if possible,
          and monitor for transfusion reactions and TACO.
        </p>
        <p><em>Administer only under senior authorisation.</em></p>
      </section>

      <section>
        <h2>Fresh Frozen Plasma (FFP)</h2>
        <p><strong>Indications:</strong></p>
        <ul>
          <li>Clinically significant bleeding with multiple coagulation factor deficiency.</li>
          <li>Massive transfusion with coagulopathy.</li>
          <li>Urgent warfarin reversal if PCC unavailable (according to local policy).</li>
        </ul>
        <p>
          <strong>Precautions:</strong>
          Risk of volume overload, allergic reactions and TRALI – monitor closely.
        </p>
        <p><em>Administer only under senior authorisation.</em></p>
      </section>

      <section>
        <h2>Cryoprecipitate</h2>
        <p><strong>Indications:</strong></p>
        <ul>
          <li>Low fibrinogen (&lt; 1.0–1.5 g/L) with bleeding or high-risk procedures.</li>
          <li>Selected cases of DIC with hypofibrinogenaemia.</li>
          <li>Inherited fibrinogen deficiency (if specific concentrate unavailable).</li>
        </ul>
        <p>
          <strong>Precautions:</strong>
          As for other blood products (viral risk, allergy, TRALI, volume).
        </p>
        <p><em>Administer only under senior authorisation.</em></p>
      </section>

      <section>
        <h2>Factor VIII / IX for Haemophilia</h2>
        <p><strong>Indications:</strong> Haemophilia A (VIII) or B (IX) with bleeding, trauma, or for procedures.</p>
        <p>
          <strong>Precautions:</strong> Monitor for inhibitors, allergic reactions, and thrombosis in high-risk patients.
        </p>
        <p><em>Administer only under senior/haematology guidance.</em></p>
      </section>

      <section>
        <h2>Massive Transfusion Protocol</h2>
        <p>
          If the calculator suggests &gt; 3 units or you are clinically concerned about major haemorrhage,
          manage according to your hospital’s massive transfusion protocol.
          You can also access our protocol here:
          <a href="https://drive.google.com/file/d/1FUIEcxcjk8abjyOx8aQKM_NZUz28-mSh/view?usp=sharing"
             target="_blank" class="emphasis-link">
            Massive Transfusion Protocol (Google Drive)
          </a>.
        </p>
      </section>
    </main>

    <script>
      function calculateTransfusion() {
        const hbInput = document.getElementById("hb-level");
        const resultEl = document.getElementById("transfusion-result");

        const hbLevel = parseFloat(hbInput.value);
        const targetHb = 10;          // ED target used in this tool
        const risePerUnit = 1.5;      // assumed Hb rise (g/dL) per unit in an average adult

        if (isNaN(hbLevel)) {
          resultEl.innerHTML = "Please enter a valid haemoglobin value.";
          return;
        }

        if (hbLevel <= 0) {
          resultEl.innerHTML =
            "The haemoglobin value entered is not physiologically plausible. Please recheck the result.";
          return;
        }

        if (hbLevel >= targetHb) {
          resultEl.innerHTML =
            "Based on a target of 10 g/dL, your patient does not require red cell transfusion. " +
            "Always consider comorbidities and discuss with a senior if unsure.";
          return;
        }

        // Calculate required units
        let rawUnitsRequired = (targetHb - hbLevel) / risePerUnit;

        if (rawUnitsRequired < 0.5) {
          resultEl.innerHTML =
            "Your patient is close to the target Hb. Red cell transfusion is usually not required, " +
            "but discuss with a senior if there are concerning features (e.g. ongoing bleeding, ACS, sepsis).";
          return;
        }

        const unitsRequired = Math.round(rawUnitsRequired);

        if (unitsRequired <= 3) {
          resultEl.innerHTML =
            `Estimated requirement: <strong>${unitsRequired} unit(s)</strong> of packed red cells. ` +
            "Adjust for weight, ongoing blood loss and your local protocol.";
        } else {
          resultEl.innerHTML =
            `Estimated requirement: <strong>${unitsRequired} unit(s)</strong> of packed red cells. ` +
            "This meets criteria for a major haemorrhage – activate or follow your massive transfusion protocol. " +
            ` You can also use our protocol here: 
              <a href="https://drive.google.com/file/d/1FUIEcxcjk8abjyOx8aQKM_NZUz28-mSh/view?usp=sharing"
                 target="_blank">Protocol Link</a>.`;
        }
      }
    </script>
  </body>
</html>
